version: "3"

set: [errexit, pipefail]

tasks:
  default:
    desc: List available tasks
    cmds:
      - task --list

  install:
    desc: Install dependencies
    cmds:
      - pnpm install

  build:
    desc: Build the package
    cmds:
      - pnpm tsup

  dev:
    desc: Build in watch mode
    cmds:
      - pnpm tsup --watch

  test:
    desc: Run tests
    cmds:
      - pnpm vitest run {{.CLI_ARGS}}

  test:watch:
    desc: Run tests in watch mode
    cmds:
      - pnpm vitest {{.CLI_ARGS}}

  lint:
    desc: Lint and type-check
    cmds:
      - pnpm oxlint
      - pnpm tsc --noEmit

  example:
    desc: Run the Petstore demo
    deps: [build]
    cmds:
      - pnpm tsx examples/petstore.ts

  example:mcp:
    desc: Run the Petstore MCP server
    deps: [build]
    cmds:
      - pnpm tsx examples/petstore-mcp-server.ts

  ci:
    desc: Run full CI pipeline (lint + test + build)
    cmds:
      - task: lint
      - task: test
      - task: build
